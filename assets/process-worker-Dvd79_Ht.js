(function(){"use strict";function P(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function H(r){if(Array.isArray(r))return r}function L(r){if(Array.isArray(r))return P(r)}function U(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function I(r,e,t){return e=A(e),Y(r,x()?Reflect.construct(e,t||[],A(r).constructor):e.apply(r,t))}function E(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function W(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,nt(n.key),n)}}function b(r,e,t){return e&&W(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function k(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=V(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(o){throw o},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,u=!0,s=!1;return{s:function(){t=t.call(r)},n:function(){var o=t.next();return u=o.done,o},e:function(o){s=!0,a=o},f:function(){try{u||t.return==null||t.return()}finally{if(s)throw a}}}}function j(){return j=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,t){var n=$(r,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?r:t):i.value}},j.apply(null,arguments)}function A(r){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},A(r)}function F(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&_(r,e)}function x(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!r})()}function Z(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function K(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,u,s=[],o=!0,c=!1;try{if(a=(t=t.call(r)).next,e!==0)for(;!(o=(n=a.call(t)).done)&&(s.push(n.value),s.length!==e);o=!0);}catch(l){c=!0,i=l}finally{try{if(!o&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(c)throw i}}return s}}function q(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return U(r)}function _(r,e){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},_(r,e)}function T(r,e){return H(r)||K(r,e)||V(r,e)||q()}function $(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=A(r))!==null;);return r}function tt(r,e,t,n){var i=j(A(r.prototype),e,t);return typeof i=="function"?function(a){return i.apply(t,a)}:i}function D(r){return L(r)||Z(r)||V(r)||Q()}function et(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function nt(r){var e=et(r,"string");return typeof e=="symbol"?e:e+""}function V(r,e){if(r){if(typeof r=="string")return P(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?P(r,e):void 0}}var z=function(e){var t=[],n=function(a,u){if(u===e){t.push(a);return}n([].concat(D(a),[0]),u+1),n([].concat(D(a),[1]),u+1)};return n([],0),t},M=b(function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;E(this,r),this.index=e,this.outputValue=t}),R=function(r){function e(t){return E(this,e),I(this,e,[t])}return F(e,r),b(e)}(M),N=function(r){function e(t,n,i){var a;return E(this,e),a=I(this,e,[i]),a.mincode=t,a.inputsFE=n,a.numInputs=n.length,a.state="not computed",a.delayFE=void 0,a}return F(e,r),b(e,[{key:"getInputValues",value:function(n){for(var i=[],a=[],u=0;u<this.numInputs;u++){var s=this.inputsFE[u],o=n.instancesFE[s];i[u]=o.outputValue,o.outputValue==null&&a.push(u)}return[i,a]}},{key:"computeFunction",value:function(n,i){var a=this,u=[];if(i)u=i.map(function(h,y){return h===null?y:-1}).filter(function(h){return h!==-1});else{var s=this.getInputValues(n),o=T(s,2);i=o[0],u=o[1]}var c=z(u.length),l=new Set,f=k(c),v;try{var p=function(){var y=v.value;u.forEach(function(w,O){i[w]=y[O]});var g=a.mincode.toString(2).padStart(Math.pow(2,a.numInputs),"0"),d=parseInt(i.join(""),2),m=parseInt(g[d],2);if(l.add(m),l.size>1)return 1};for(f.s();!(v=f.n()).done&&!p(););}catch(h){f.e(h)}finally{f.f()}return l.size===1?D(l)[0]:null}}])}(M),rt=function(r){function e(t){var n;return E(this,e),n=I(this,e,[t]),n.outputValue=0,n}return F(e,r),b(e)}(M),G=function(r){function e(t,n,i,a){var u;return E(this,e),u=I(this,e,[t,n,i]),u.inverses=a,u}return F(e,r),b(e,[{key:"getInputValues",value:function(n){for(var i=[],a=[],u=0;u<this.numInputs;u++){var s=this.inputsFE[u],o=n.instancesFE[s];i[u]=o.outputValue==null?o.outputValue:o.outputValue^this.inverses[u],o.outputValue==null&&a.push(u)}return[i,a]}}])}(N),it=function(r){function e(t,n,i){var a;return E(this,e),a=I(this,e,[1,t,n]),a.inverses=i,a}return F(e,r),b(e)}(G),J=function(){function r(){E(this,r),this.number=void 0,this.format=void 0,this.countInputs=0,this.countFE=0,this.instancesFE={},this.outputNums=[],this.inputsNums=[],this.outputValues={},this.depth=void 0,this.delay=void 0,this.signDelay=void 0,this.allPaths=[],this.depthsDict={},this.xDepthsDict={}}return b(r,[{key:"validateCircuit",value:function(t,n){if(!t||t.format!=="fcircuit")throw new Error("Invalid format or circuit number: ".concat(n))}},{key:"parseCircuit",value:function(t,n){var i=t.get(n);this.validateCircuit(i,n),this.format=i.format,this.number=i.number,this.countInputs=i.countInputs,this.countFE=i.countFE,this.outputNums=i.outputNums,this.creatingElements(i);for(var a=0,u=Object.keys(this.instancesFE);a<u.length;a++){var s=u[a],o=this.instancesFE[s],c=void 0;if(!(o.index<=this.countInputs)){var l=!0,f=k(o.inputsFE),v;try{for(f.s();!(v=f.n()).done;){var p=v.value;if(!(p in this.instancesFE)||p===o.index){c=p,l=!1;break}}}catch(h){f.e(h)}finally{f.f()}if(!l)throw new Error("Invalid input index (".concat(c,") of a functional element (").concat(o.index,")"))}}return i}},{key:"creatingElements",value:function(t){for(var n=1;n<this.countInputs+1;n++)this.inputsNums.push(n),this.instancesFE[n]=new R(n);for(var i=0;i<t.countFE;i++){var a=t.instancesFE[i];this.instancesFE[a.id]=new N(a.mincode,a.inputsFE,a.id)}}},{key:"findAllRoots",value:function(){for(var t=new Set(Object.keys(this.instancesFE).map(Number)),n=0,i=Object.values(this.instancesFE);n<i.length;n++){var a=i[n];if(a.index<=this.countInputs)t.delete(a.index);else{var u=k(a.inputsFE),s;try{for(u.s();!(s=u.n()).done;){var o=s.value;t.delete(o)}}catch(c){u.e(c)}finally{u.f()}}}return Array.from(t)}},{key:"dfs",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];n.add(t.index),i.push(t.index);var a=[];if(t.index<=this.countInputs)a.push(D(i));else{var u=k(t.inputsFE),s;try{for(u.s();!(s=u.n()).done;){var o=s.value,c=this.instancesFE[o];n.has(c.index)||(a=a.concat(this.dfs(c,n,i)))}}catch(l){u.e(l)}finally{u.f()}}return i.pop(),n.delete(t.index),a}},{key:"findAllPaths",value:function(){var t=this.findAllRoots(),n=[],i=k(t),a;try{for(i.s();!(a=i.n()).done;){var u=a.value,s=this.instancesFE[u];n=n.concat(this.dfs(s))}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"calculateDepth",value:function(t){if(t.length===0)throw new Error("allPaths array is empty");var n=Math.max.apply(Math,D(t.map(function(i){return i.length})))-1;return n}},{key:"buildDepthsDict",value:function(t){var n={};if(t.length===0)throw new Error("allPaths array is empty");var i=k(t),a;try{for(i.s();!(a=i.n()).done;)for(var u=a.value,s=0;s<u.length;s++){var o=u.length-1-s,c=u[s],l=!1;for(var f in n)if(f>o&&n[f].has(c)){l=!0;break}if(!l){for(var v in n)v<o&&n[v].has(c)&&n[v].delete(c);n[o]||(n[o]=new Set),n[o].add(c)}}}catch(p){i.e(p)}finally{i.f()}return n}},{key:"buildXDepthsDict",value:function(t){var n={};if(t.length===0)throw new Error("allPaths array is empty");var i=k(t),a;try{for(i.s();!(a=i.n()).done;)for(var u=a.value,s=0;s<u.length;s++){var o=u.length-1-s,c=u[s];n[o]||(n[o]=new Set),n[o].add(c)}}catch(l){i.e(l)}finally{i.f()}return n}},{key:"initializeCircuit",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this._initializeCircuitInternal(t,0)}},{key:"_initializeCircuitInternal",value:function(t,n){var i=this;if(t<0||t>Math.pow(2,this.countInputs)-1||isNaN(t))throw new Error("set number must be in range 0..".concat(Math.pow(2,this.countInputs)-1));var a=z(this.countInputs),u=a[t];return Object.keys(this.instancesFE).slice(n,this.countInputs+1).forEach(function(s,o){var c=i.instancesFE[s];c.outputValue=u[o]}),u}},{key:"simulateCircuit",value:function(t){var n=this,i={};if(Object.keys(t).length===0)throw new Error("depths dict is empty");var a=function(){if(u==="0")return 1;var o=t[u],c={},l={};o.forEach(function(d){var m=n.instancesFE[d];if(m.state!=="computed"){var w=m.computeFunction(n);l[d]=w,c[m.index]={state:w===null?"uncertain":"computed",outputValue:w}}else c[m.index]={state:m.state,outputValue:m.outputValue}});for(var f=0,v=Object.entries(l);f<v.length;f++){var p=T(v[f],2),h=p[0],y=p[1],g=n.instancesFE[h];y!==null?(g.state="computed",g.outputValue=y):g.state="uncertain"}i[u]=c};for(var u in t)a();return i}},{key:"calculateOutput",value:function(){var t=this,n=Object.values(this.instancesFE).filter(function(i){return t.outputNums.includes(i.index)});return n.forEach(function(i){var a=i.index;if(t.instancesFE[a].outputValue==null)throw new Error("output value has not been calculated yet");t.outputValues[a]=t.instancesFE[a].outputValue}),this.outputValues}},{key:"calculateDelay",value:function(t){if(Object.keys(t).length===0)throw new Error("states dict is empty");for(var n=[],i=new Set,a=0,u=Object.keys(t);a<u.length;a++)for(var s=u[a],o=0,c=Object.keys(t[s]);o<c.length;o++){var l=c[o];t[s][l].state==="computed"&&!i.has(l)&&(this.instancesFE[l].delayFE=s,i.add(l),this.outputNums.includes(+l)&&n.push(+s))}var f=Math.max.apply(Math,n);return this.delay=f,f}},{key:"searchSignChains",value:function(t){var n=this,i=function(l,f,v,p,h,y){if(!l.has(f))return!1;var g=v[p];return g.some(function(d){return d.length>h&&d[h]===y})};if(t.length===0)throw new Error("method searchSignChains: allPaths array is empty");var a={},u=[],s={},o=new Set;return t.forEach(function(c){if(!(!n.outputNums.includes(c[0])||c.includes(0))){var l=c.join("-"),f=D(c).reverse().join("-"),v;l in a?(v=a[l].length,a[l].push([])):(v=0,a[l]=[[]]);var p=!1,h=[],y=k(c),g;try{for(y.s();!(g=y.n()).done;){var d=g.value;if(!(d<=n.countInputs)){var m=c.indexOf(d),w=[],O=[],C=n.instancesFE[d];new Set(C.inputsFE).size!==C.inputsFE.length&&o.add(d),w=C.getInputValues(n)[0],O=D(w);for(var S=0;S<C.inputsFE.length;S++)if(c[m+1]===C.inputsFE[S]&&!i(o,d,a,l,m,+S)){h.push("".concat(C.inputsFE[S],"-").concat(S,"-").concat(C.index)),a[l][v].push(+S),O[S]=1-w[S];var ft=C.outputValue,ht=C.computeFunction(null,O);if(ft!==ht)p=!0;else{p=!1;return}break}}}}catch(vt){y.e(vt)}finally{y.f()}p&&(s[f]||(s[f]=[]),s[f].push(h.reverse().join("_")),u.push(c))}}),[u,s]}},{key:"calculateSignDelay",value:function(t){if(t.length===0)return 0;var n=this.calculateDepth(t);return n}}])}(),B=function(r){function e(){var t;return E(this,e),t=I(this,e),t.outputInversion,t}return F(e,r),b(e,[{key:"validateCircuit",value:function(n,i){throw new Error("Method validateCircuit must be implemented.")}},{key:"parseCircuit",value:function(n,i){var a=tt(e,"parseCircuit",this)([n,i]);this.outputNums=a.output,this.outputInversion=a.inversion}},{key:"creatingElements",value:function(n){throw new Error("Method creatingElements must be implemented.")}},{key:"calculateOutput",value:function(){var n=this.outputNums[0];if(this.instancesFE[n].outputValue==null)throw new Error("output value has not been calculated yet");return this.outputValues[n]=this.instancesFE[n].outputValue^this.outputInversion,this.outputValues}}])}(J),at=function(r){function e(){var t;return E(this,e),t=I(this,e),t.outputInversion,t}return F(e,r),b(e,[{key:"validateCircuit",value:function(n,i){if(!n||n.format!=="aig")throw new Error("Invalid format or circuit number: ".concat(i))}},{key:"creatingElements",value:function(n){for(var i=1;i<this.countInputs+1;i++)this.inputsNums.push(i),this.instancesFE[i]=new R(i);for(var a=0;a<n.countFE;a++){var u=n.instancesFE[a];this.instancesFE[u.id]=new it(u.inputsFE,u.id,u.inverses)}}}])}(B),ut=function(r){function e(t,n,i){var a;return E(this,e),a=I(this,e,[23,t,n]),a.inverses=i,a}return F(e,r),b(e)}(G),ot=function(r){function e(){var t;return E(this,e),t=I(this,e),t.outputInversion,t}return F(e,r),b(e,[{key:"validateCircuit",value:function(n,i){if(!n||n.format!=="mig")throw new Error("Invalid format or circuit number: ".concat(i))}},{key:"creatingElements",value:function(n){this.instancesFE[0]=new rt(0);for(var i=1;i<this.countInputs+1;i++)this.inputsNums.push(i),this.instancesFE[i]=new R(i);for(var a=0;a<n.countFE;a++){var u=n.instancesFE[a];this.instancesFE[u.id]=new ut(u.inputsFE,u.id,u.inverses)}}},{key:"initializeCircuit",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this._initializeCircuitInternal(n,1)}}])}(B);function X(r){switch(r){case"fcircuit":return new J;case"mig":return new ot;case"aig":return new at;default:throw new Error(`Unknown format: ${r}`)}}function st(r){return`[
`+r.map(e=>{const t=e.setResults.map(n=>`        ${JSON.stringify(n)}`).join(`,
`);return`  {
    "number": ${e.number},
    "depth": ${e.depth},
    "setResults": [
${t}
    ]
  }`}).join(`,
`)+`
]`}let ct=!1;function lt(r){if(!Array.isArray(r))throw new Error("The JSON data is not an array");if(!r||!r.length)throw new Error("The JSON data is empty");const e=new Map;r.forEach(a=>{e.set(a.number,a)});const t=[],n=[];let i=0;for(const a of r)try{let u,s;const o=[],c=2**a.countInputs,l=a.format;u=X(l),u.parseCircuit(e,+a.number);const f=u.findAllPaths(),v=u.buildXDepthsDict(f);s=u.calculateDepth(f);for(let h=0;h<c;h++){let y={};u=X(l),u.parseCircuit(e,+a.number),u.initializeCircuit(h),y=u.simulateCircuit(v);const g=u.calculateOutput(),d=u.calculateDelay(y),[m,w]=u.searchSignChains(f),O=u.calculateSignDelay(m);o.push({inputSet:h.toString(2).padStart(u.countInputs,"0"),outputValue:g,delay:d,signDelay:O})}const p={number:a.number,depth:s,setResults:o};t.push(p),i++}catch(u){console.error(`Error processing circuit ${a.number}:`,u),n.push({number:a.number,error:`Error: ${u.message}`})}return{resultData:st(t),errorData:n}}self.onmessage=function(r){const e=r.data;try{const{resultData:t,errorData:n}=lt(e);self.postMessage({resultData:t,errorData:n})}catch(t){self.postMessage({error:t.message})}}})();
